<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create the GNPS .mgf backbone file format — write_mgf_gnps • MS2extract</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Create the GNPS .mgf backbone file format — write_mgf_gnps"><meta name="description" content="This function facilitates to create the structure of the GNPS .mgf format.
For more information about submitting your spectra to GNPS, please
visit this link.
You can find the GNPS template spreadsheet in this
link."><meta property="og:description" content="This function facilitates to create the structure of the GNPS .mgf format.
For more information about submitting your spectra to GNPS, please
visit this link.
You can find the GNPS template spreadsheet in this
link."><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SB0NT1KJYH"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SB0NT1KJYH');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MS2extract</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Aintroduction.html">1 - Introduction to MS2extract</a></li>
    <li><a class="dropdown-item" href="../articles/Busing_batch_extract.html">2 - Using the MS2extract batch pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/Cimport_mzml_explanation.html">3 - Behind the curtains of importing MS/MS data</a></li>
    <li><a class="dropdown-item" href="../articles/Dmsconvert_4_MS2extract.html">4 - Using MSconvert to filter useful standard MS/MS data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CooperstoneLab/MS2extract" aria-label="Github"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/cristianquirozd" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.linkedin.com/in/danielquirozmoreno/" aria-label="Linkedin"><span class="fa fa-linkedin"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create the GNPS <code>.mgf</code> backbone file format</h1>
      <small class="dont-index">Source: <a href="https://github.com/CooperstoneLab/MS2extract/blob/main/R/write_mgf.R" class="external-link"><code>R/write_mgf.R</code></a></small>
      <div class="d-none name"><code>write_mgf_gnps.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function facilitates to create the structure of the GNPS .mgf format.
For more information about submitting your spectra to GNPS, please
visit this <a href="https://ccms-ucsd.github.io/GNPSDocumentation/batchupload" class="external-link">link</a>.
You can find the GNPS template spreadsheet in this
<a href="https://ccms-ucsd.github.io/GNPSDocumentation/static/Template.xlsx" class="external-link">link</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">write_mgf_gnps</span><span class="op">(</span>spec <span class="op">=</span> <span class="cn">NULL</span>, spec_metadata <span class="op">=</span> <span class="cn">NULL</span>, mgf_name <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-spec">spec<a class="anchor" aria-label="anchor" href="#arg-spec"></a></dt>
<dd><p>a data frame containing the extracted MS/MS spectra, the following
column are required:</p>
<dl><dt>mz_precursor</dt>
<dd><p>precursor ion</p></dd>

<dt>rt</dt>
<dd><p>retention time</p></dd>

<dt>mz</dt>
<dd><p><em>m/z</em>  values</p></dd>

<dt>intensity</dt>
<dd><p>intensity values</p></dd>


</dl></dd>


<dt id="arg-spec-metadata">spec_metadata<a class="anchor" aria-label="anchor" href="#arg-spec-metadata"></a></dt>
<dd><p>a data frame containing the values to be including
in the resulting <code>.mgf</code> file. In this case, this is the minimum mandatory
information to be included.</p>
<p>The full explanation about fields and field content can be found in
GNPS batch library upload
<a href="https://ccms-ucsd.github.io/GNPSDocumentation/batchupload" class="external-link">link</a>.</p>
<p>For the rest of fields that are included in the final library file,
MS2extract will get this information for the extracted spectra.</p>
<p>We highly suggest to check the <code>gnps_template.xlsx</code> file described in
the function example to check what fields/columns are required in
MS2extract.</p>
<dl><dt>COMPOUND_NAME</dt>
<dd><p>character, Metabolite name, it has to be the same
name used in <code>met_metadata</code>, the data frame used to import your MS/MS data</p></dd>

<dt>INSTRUMENT</dt>
<dd><p>character, instrument used for data collection</p></dd>

<dt>COLLISIONENERGY</dt>
<dd><p>character, collision energy used in MS/MS
fragmentation</p></dd>

<dt>IONSOURCE</dt>
<dd><p>Ionization source</p></dd>

<dt>SMILES</dt>
<dd><p>character, SMILES chemical structure of your metabolite</p></dd>

<dt>INCHI</dt>
<dd><p>character, Inchi value for the metabolite</p></dd>

<dt>INCHIAUX</dt>
<dd><p>character, INCHIAUX for the metabolite</p></dd>

<dt>IONMODE</dt>
<dd><p>character, ionization polarity</p></dd>

<dt>PUBMED</dt>
<dd><p>character, PUBMED id where you submitted the MS/MS spectra</p></dd>

<dt>ACQUISITION</dt>
<dd><p>character, Crude, Lysate, Commercial, Isolated, Other</p></dd>

<dt>DATACOLLECTOR</dt>
<dd><p>character, Person who collected the MS/MS data</p></dd>

<dt>INTEREST</dt>
<dd><p>character, interest of the MS/MS data</p></dd>

<dt>LIBQUALITY</dt>
<dd><p>character, library quality.
1 for Gold, 2 for Silver, 3 for Bronze</p></dd>

<dt>GENUS</dt>
<dd><p>character, genus of the organism</p></dd>

<dt>SPECIES</dt>
<dd><p>character, species of the organism</p></dd>

<dt>STRAIN</dt>
<dd><p>character, strain of the organism</p></dd>

<dt>CASNUMBER</dt>
<dd><p>character, CAS number of the metabolite</p></dd>

<dt>PI</dt>
<dd><p>character, principal investigator</p></dd>


</dl></dd>


<dt id="arg-mgf-name">mgf_name<a class="anchor" aria-label="anchor" href="#arg-mgf-name"></a></dt>
<dd><p>file name for the exported <code>.mgf</code>library. It does not have
to contain the file extension  <code>.mgf</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>if batch spectra are found, this function writes two files,
the <code>.mgf</code> library and the required <code>.tsv</code> table required by GNPS. If single
spectrum is detected, it will only write the <code>.mgf</code> library.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Example with batch spectra ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Select the csv file name and path</span></span></span>
<span class="r-in"><span><span class="va">batch_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"batch_read.csv"</span>,</span></span>
<span class="r-in"><span>  package <span class="op">=</span> <span class="st">"MS2extract"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Read the data frame</span></span></span>
<span class="r-in"><span><span class="va">batch_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">batch_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># File paths for Procyanidin A2 and Rutin</span></span></span>
<span class="r-in"><span><span class="va">ProcA2_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"ProcyanidinA2_neg_20eV.mzXML"</span>,</span></span>
<span class="r-in"><span>  package <span class="op">=</span> <span class="st">"MS2extract"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Rutin_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Rutin_neg_20eV.mzXML"</span>,</span></span>
<span class="r-in"><span>  package <span class="op">=</span> <span class="st">"MS2extract"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add file path - User should specified the file path -</span></span></span>
<span class="r-in"><span><span class="va">batch_data</span><span class="op">$</span><span class="va">File</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ProcA2_file</span>, <span class="va">Rutin_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Checking batch_data data frame</span></span></span>
<span class="r-in"><span><span class="va">batch_data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Name   Formula Ionization_mode min_rt max_rt COLLISIONENERGY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Procyanidin A2 C30H24O12        Negative    163    180           20 eV</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          Rutin C27H30O16        Negative    162    171           20 eV</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                              File</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 /home/runner/work/_temp/Library/MS2extract/extdata/ProcyanidinA2_neg_20eV.mzXML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         /home/runner/work/_temp/Library/MS2extract/extdata/Rutin_neg_20eV.mzXML</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using batch import to import multiple compounds</span></span></span>
<span class="r-in"><span><span class="va">batch_compounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="batch_import_mzxml.html">batch_import_mzxml</a></span><span class="op">(</span><span class="va">batch_data</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Begining batch import</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">--</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Processing: ProcyanidinA2_neg_20eV.mzXML</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Found 1 CE value: 20</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Remember to match CE velues in <span style="font-style: italic;">spec_metadata</span> when exporting your library</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • m/z range given 10 ppm: 575.11376 and 575.12526</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Compound name: <span style="color: #00BB00;">Procyanidin A2_Negative_20</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">--</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Processing: Rutin_neg_20eV.mzXML</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Found 1 CE value: 20</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Remember to match CE velues in <span style="font-style: italic;">spec_metadata</span> when exporting your library</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • m/z range given 10 ppm: 609.14002 and 609.15221</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Compound name: <span style="color: #00BB00;">Rutin_Negative_20</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">End batch import</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────────</span></span>
<span class="r-in"><span><span class="co"># Checking dimension by compound</span></span></span>
<span class="r-in"><span><span class="co"># Procyanidin A2: 24249 ions</span></span></span>
<span class="r-in"><span><span class="co"># Rutin: 22096 ions</span></span></span>
<span class="r-in"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">batch_compounds</span>, <span class="va">dim</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`Procyanidin A2_Negative_20`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 17829     6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Rutin_Negative_20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 11475     6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">batch_extracted_compounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="batch_extract_MS2.html">batch_extract_MS2</a></span><span class="op">(</span><span class="va">batch_compounds</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Scale for <span style="color: #00BB00;">x</span> is already present.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Adding another scale for <span style="color: #00BB00;">x</span>, which will replace the existing scale.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`position_stack()` requires non-overlapping <span style="color: #00BB00;">x</span> intervals.</span>
<span class="r-plt img"><img src="write_mgf_gnps-1.png" alt="" width="700" height="433"></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Scale for <span style="color: #00BB00;">x</span> is already present.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Adding another scale for <span style="color: #00BB00;">x</span>, which will replace the existing scale.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`position_stack()` requires non-overlapping <span style="color: #00BB00;">x</span> intervals.</span>
<span class="r-plt img"><img src="write_mgf_gnps-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Batch detect mass</span></span></span>
<span class="r-in"><span><span class="va">batch_mass_detected</span> <span class="op">&lt;-</span> <span class="fu"><a href="batch_detect_mass.html">batch_detect_mass</a></span><span class="op">(</span><span class="va">batch_extracted_compounds</span>,</span></span>
<span class="r-in"><span>  normalize <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># Normalize</span></span></span>
<span class="r-in"><span>  min_int <span class="op">=</span> <span class="fl">1</span> <span class="co"># Minimum intensity</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reading metadata from GNPS template</span></span></span>
<span class="r-in"><span><span class="va">template_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GNPS_template.xlsx"</span>,</span></span>
<span class="r-in"><span>                 package <span class="op">=</span> <span class="st">"MS2extract"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gnps_template</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">template_file</span>,</span></span>
<span class="r-in"><span>                sheet <span class="op">=</span> <span class="st">"batch_example"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">write_mgf_gnps</span><span class="op">(</span>spec <span class="op">=</span> <span class="va">batch_mass_detected</span>,</span></span>
<span class="r-in"><span>               spec_metadata <span class="op">=</span> <span class="va">gnps_template</span>,</span></span>
<span class="r-in"><span>               mgf_name <span class="op">=</span> <span class="st">"PhenolicsDB"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Filtering MS/MS scans for 20 CE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Filtering MS/MS scans for 20 CE</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cristian Quiroz-Moreno, Jessica Cooperstone.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

