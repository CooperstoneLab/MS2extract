<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MS2extract">
<title>1 - Introduction to MS2extract • MS2extract</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="1 - Introduction to MS2extract">
<meta property="og:description" content="MS2extract">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SB0NT1KJYH"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SB0NT1KJYH');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MS2extract</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.01.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Aintroduction.html">1 - Introduction to MS2extract</a>
    <a class="dropdown-item" href="../articles/Busing_batch_extract.html">2 - Using the MS2extract batch pipeline</a>
    <a class="dropdown-item" href="../articles/Cimport_mzml_explanation.html">3 - Behind the curtains of importing MS/MS data</a>
    <a class="dropdown-item" href="../articles/Dmsconvert_4_MS2extract.html">4 - Using MSconvert to filter useful standard MS/MS data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/CooperstoneLab/MS2extract" aria-label="Github">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/cristianquirozd" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.linkedin.com/in/danielquirozmoreno/" aria-label="Linkedin">
    <span class="fa fa-linkedin"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>1 - Introduction to MS2extract</h1>
                        <h4 data-toc-skip class="author">Cristian
Quiroz-Moreno &amp; Jessica Cooperstone</h4>
            
            <h4 data-toc-skip class="date">2023-10-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/CooperstoneLab/MS2extract/blob/HEAD/vignettes/Aintroduction.Rmd" class="external-link"><code>vignettes/Aintroduction.Rmd</code></a></small>
      <div class="d-none name"><code>Aintroduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette has the objective to introduce the
<strong>MS2extract</strong>. The main goal of this package is to provide
a tool to create in-house MS/MS compound libraries. Users can access a
specific function help through the command help(<em>[‘function
name’]</em>). It is worth to note that this package is aimed in the
targeted extraction of MS/MS scans and it is not able to perform
compound match or annotation.</p>
<p>A simplified workflow is presented in Figure 1. Briefly, mzMl/mzXML
files are imported in memory, then based on metadata provided by the
user such as analyte chemical formula, and ionization mode, MS2extract
computes the theoretical precursor <em>m</em>/<em>z</em>. Then, product
ion scans that matches the theoretical analyte precursor ion are
extracted, with a given ppm tolerance. Next, low intensity signals, or
background noise can be removed from the spectra. Finally, users can
export the extracted MS/MS spectra to a MS/MS library format (.msp/.mgf)
to be used as reference library for further compound identification and
annotation, or deposit the created library in different repositories
such as GNPS, or MassBank.</p>
<div class="figure" style="text-align: center">
<img src="img/pipeline.png" alt="Figure 1. Overview of the processing pipeline of MS2extract" width="80%" height="80%"><p class="caption">
Figure 1. Overview of the processing pipeline of MS2extract
</p>
</div>
</div>
<div class="section level2">
<h2 id="basic-workflow">Basic workflow<a class="anchor" aria-label="anchor" href="#basic-workflow"></a>
</h2>
<p>The workflow has four main steps:</p>
<ul>
<li>data import,</li>
<li>extract MS/MS scans,</li>
<li>detect masses, and</li>
<li>export the MS/MS library</li>
</ul>
<p>In this section, we will explain in a more detailed manner the main
steps to create in-house MS/MS libraries, as well as provide information
about the required and optional arguments that users may need to provide
in order to effectively use this package.</p>
<p>Additionally, this package also includes a set of
<code>batch_*()</code> functions that allows to process multiple .mzXML
files at once. However, more metadata is required to run this automated
pipeline and the use of this <code>batch_*()</code> functions will is
described in the <a href="https://cooperstonelab.github.io/MS2extract/articles/Busing_batch_extract.html">Using
MS2extract Batch Pipeline</a>.</p>
<div class="section level3">
<h3 id="data-import">Data import<a class="anchor" aria-label="anchor" href="#data-import"></a>
</h3>
<p>This section is focused on describing how MS2extract package imports
MS/MS data. We also include a more detailed document about this process
in the <a href="https://cooperstonelab.github.io/MS2extract/articles/Cimport_mzml_explanation.html">Behind
the curtains of importing MS/MS data</a> vignette.</p>
<p>The main import function relies on R package <a href="https://metid.tidymass.org" class="external-link">metID</a>. We adapted the import
function in order to read mass spectrometry data from mzML/mzXML files.
The new adaptation consists in importing scans data in a list (S3
object) rather than into a S4 object, facilitating the downstream tidy
analysis of this object.</p>
<blockquote>
<p>This function execute a back-end calculation of theoretical ionized
<em>m</em>/<em>z</em> of the compound in order to extract the precursor
ions that match that mass with a given ppm.</p>
</blockquote>
<p>The arguments of the <code><a href="../reference/import_mzxml.html">import_mzxml()</a></code> functions are
four:</p>
<ul>
<li>
<strong>file:</strong> mzML/mzXML file name</li>
<li>
<strong>met_metadata:</strong> metadata of the analyte</li>
<li>
<strong>ppm:</strong> error mass expressed in ppm</li>
<li>…</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Loading the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cooperstonelab.github.io/MS2extract/">MS2extract</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Print function arg</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">import_mzxml</span><span class="op">)</span></span>
<span><span class="co">#&gt; $file</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $met_metadata</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ppm</span></span>
<span><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<div class="section level4">
<h4 id="file">file<a class="anchor" aria-label="anchor" href="#file"></a>
</h4>
<p>File should contain the name of your mzML/mzXML file that contains
MS/MS data of authentic standards or reference material. Here, we
provide an example file of procyanidin A2 collected in negative
ionization mode, and a collision energy of 20 eV.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Importing  Procyanidin A2 MS/MS spectra in negative ionization mode</span></span>
<span><span class="co"># and 20 eV as the collision energy</span></span>
<span><span class="va">ProcA2_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>  <span class="st">"ProcyanidinA2_neg_20eV.mzXML"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"MS2extract"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># File name</span></span>
<span><span class="va">ProcA2_file</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/MS2extract/extdata/ProcyanidinA2_neg_20eV.mzXML"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="met_metadata">met_metadata<a class="anchor" aria-label="anchor" href="#met_metadata"></a>
</h4>
<p>This argument refers to the compound metadata that user need to
provide in order to properly import scans that are related to the
compound of interest.</p>
<p>The <code>met_metadata</code> is a data frame that has required and
optional columns. The required columns are employed to calculate the
theoretical ionized <em>m</em>/<em>z</em> for a given formula and
ionization mode. In the optional columns, we have the option to provide
a chromatographic region of Interest (ROI), specifying at what time the
the compound elutes, in order to only keep this retention time
window.</p>
<p>The required columns are:</p>
<ul>
<li>
<strong>Formula:</strong> A character string specifying the
metabolite formula</li>
<li>
<strong>Ionization_mode:</strong> The ionization mode employed in
data collection.</li>
</ul>
<p>The optional columns are:</p>
<ul>
<li>
<strong>min_rt:</strong> a double with the minimum retention time to
keep (in seconds)</li>
<li>
<strong>max_rt:</strong> a double with the minimum retention time to
keep (in seconds)</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Procyanidin A2 metadata</span></span>
<span><span class="va">ProcA2_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Formula <span class="op">=</span> <span class="st">"C30H24O12"</span>, Ionization_mode <span class="op">=</span> <span class="st">"Negative"</span>,</span>
<span>  min_rt <span class="op">=</span> <span class="fl">163</span>, max_rt <span class="op">=</span> <span class="fl">180</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ProcA2_data</span></span>
<span><span class="co">#&gt;     Formula Ionization_mode min_rt max_rt</span></span>
<span><span class="co">#&gt; 1 C30H24O12        Negative    163    180</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="ppm">ppm<a class="anchor" aria-label="anchor" href="#ppm"></a>
</h4>
<p>ppm refers to the maximum m/z deviation from the theoretical mass. A
ppm of 10 units will mean that the total allows <em>m</em>/<em>z</em>
window in 20 ppm. By default, 10 ppm is used.</p>
</div>
<div class="section level4">
<h4 id="import_mzxml">
<code>import_mzxml()</code><a class="anchor" aria-label="anchor" href="#import_mzxml"></a>
</h4>
<p>With all arguments explained, we can use the
<code><a href="../reference/import_mzxml.html">import_mzxml()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import Procyanidin A2 data</span></span>
<span><span class="va">ProcA2_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_mzxml.html">import_mzxml</a></span><span class="op">(</span><span class="va">ProcA2_file</span>, met_metadata <span class="op">=</span> <span class="va">ProcA2_data</span>, ppm <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; • Processing: ProcyanidinA2_neg_20eV.mzXML</span></span>
<span><span class="co">#&gt; • Found 1 CE value: 20</span></span>
<span><span class="co">#&gt; • Remember to match CE velues in <span style="font-style: italic;">spec_metadata</span> when exporting your library</span></span>
<span><span class="co">#&gt; • m/z range given 5 ppm: 575.11663 and 575.12238</span></span>
<span></span>
<span><span class="co"># 24249 rows = ions detected in all scans</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ProcA2_raw</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 24249     6</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="extracting-msms-spectra">Extracting MS/MS spectra<a class="anchor" aria-label="anchor" href="#extracting-msms-spectra"></a>
</h3>
<p>Now that we have the data imported, we can proceed to extract the
<strong>most intense MS/MS scan</strong>.</p>
<p>This function computes the MS/MS total ion chromatogram (TIC) by
summing up all intensities of the MS/MS scans, and selects the scan with
the highest total intensity. It is worth noting that we only imported
MS/MS scans that the precursor ion matches the theoretical <em>m/z</em>
value of the compound provided in the previous step. Therefore, it is
more accurrate to interpret this chromatogram as an EIC of the precursor
ion, where only the MS/MS scans are included.</p>
<p>This function takes three arguments:</p>
<ul>
<li>
<strong>spec:</strong> the imported MS/MS spectra</li>
<li>
<strong>verbose:</strong> a boolean, if <code>verbose = TRUE</code>,
the MS/MS TIC and spectra is printed, if <code>verbose = FALSE</code>,
plots are not displayed</li>
<li>
<strong>out_list:</strong> a boolean, if
<code>out_list = TRUE</code>, the extracted MS/MS spectra table and
plots are returned as list, otherwise only the MS/MS spectra is returned
as data frame.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ProcA2_extracted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_MS2.html">extract_MS2</a></span><span class="op">(</span><span class="va">ProcA2_raw</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, out_list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `position_stack()` requires non-overlapping <span style="color: #00BB00;">x</span> intervals</span></span></code></pre></div>
<p><img src="Aintroduction_files/figure-html/unnamed-chunk-6-1.png" width="100%" height="100%"></p>
<p>We generated two plots, the MS/MS EIC of the precursor ion (top
plot), and the MS/MS spectra of the most intense MS/MS scan (bottom
plot). In the MS/MS spectra, the blue diamond is placed on top of the
precursor <em>m/z</em> ion. If the diamond is filled in blue, it means
the precursor ion was found in the MS/MS fragmentation data, while a
diamond that is not filled will represent that the precursor ion was not
found in the fragmentation data.</p>
<p>Furthemore, we can note that the x axis in the MS/MS spectra ranges
from 0 to 1700 <em>m/z</em>. This is more related to the acquisition
parameters used in data callection <em>m/z</em> range: 50-1700, which
creates low intensity signal that are captured and included in the
resulting MS/MS spectra.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">ProcA2_extracted</span><span class="op">$</span><span class="va">mz</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  100.0852 1699.0981</span></span></code></pre></div>
<p>The range of the MS/MS <em>m</em>/<em>z</em> values are from 100 to
1699 <em>m</em>/<em>z</em>, but intensities are too low to be seen in
the plot.</p>
</div>
<div class="section level3">
<h3 id="detecting-masses">Detecting masses<a class="anchor" aria-label="anchor" href="#detecting-masses"></a>
</h3>
<p>Similarly to the <a href="http://mzmine.github.io/" class="external-link">MZmine
pipeline</a>, detecting masses refers to setting a signal intensity
threshold that MS/MS ions has to meet to be kept in the data, while
signals that do not meet the defined threshold are removed. This
function can also normalize the spectra ion intensity to percentage
based on the base peak. This is a filtering step that is based on
percentage of the base peak (most intense ion).</p>
<p>The three required arguments are:</p>
<ul>
<li>
<strong>spec:</strong> a data frame containing the MS/MS
spectra.</li>
<li>
<strong>normalize:</strong> a boolean indicating if the MS/MS
spectra is normalized by the base peak before proceeding to filter out
low intensity signals (normalize = TRUE), if normalize = FALSE the user
has to provide the minimum ion count.</li>
<li>
<strong>min_int:</strong> an integer referring to the minimum ion
intensity. The value of <em>min_int</em> has to be in line if user
decides to normalize the spectra or not. If the spectra is normalized,
the <em>min_intensity</em> value is in percentage, otherwise the
<em>min_intensity</em> value is expressed in ion count units.</li>
</ul>
<p>By default, the normalization is set to <code>TRUE</code> and the
minimum intensity is set to 1% to remove background noise.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ProcA2_detected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect_mass.html">detect_mass</a></span><span class="op">(</span><span class="va">ProcA2_extracted</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span>, min_int <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We can see now the range of m/z values and the maximum value is
576.1221 m/z.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">ProcA2_detected</span><span class="op">$</span><span class="va">mz</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 125.0243 576.1221</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="msms-spectra-plot">MS/MS spectra plot<a class="anchor" aria-label="anchor" href="#msms-spectra-plot"></a>
</h3>
<p>We can proceed to plot the filtered MS/MS spectra with
<code><a href="../reference/plot_MS2spectra.html">plot_MS2spectra()</a></code> function. This is a ggplot2 based
function; the blue diamond refers to the precursor ion.</p>
<p>If we take a look to the previous MS/MS plot, there is less
background noise in this MS/MS spectra because the low intensity ions
have been removed.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_MS2spectra.html">plot_MS2spectra</a></span><span class="op">(</span><span class="va">ProcA2_detected</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `position_stack()` requires non-overlapping <span style="color: #00BB00;">x</span> intervals</span></span></code></pre></div>
<p><img src="Aintroduction_files/figure-html/unnamed-chunk-10-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="exporting-msms-spectra">Exporting MS/MS spectra<a class="anchor" aria-label="anchor" href="#exporting-msms-spectra"></a>
</h3>
<div class="section level4">
<h4 id="nist--msp-format">NIST .msp format<a class="anchor" aria-label="anchor" href="#nist--msp-format"></a>
</h4>
<p>Finally after extracting the MS/MS spectra and removing background
noise, we can proceed to export the MS/MS in a NIST .msp format.</p>
<p>For this task, we need extra information about the compound, such as
SMILES, COLLISIONENERGY, etc. You can find the minimum required
information by accessing the <code><a href="../reference/write_msp.html">write_msp()</a></code> function help by
running the command <code><a href="../reference/write_msp.html">?write_msp</a></code>.</p>
<p>An example of this table can be found at:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reading the metadata</span></span>
<span><span class="va">metadata_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>  <span class="st">"msp_metadata.csv"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"MS2extract"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">metadata_file</span><span class="op">)</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1</span></span>
<span><span class="co">#&gt; Columns: 8</span></span>
<span><span class="co">#&gt; $ NAME            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Procyanidin A2"</span></span>
<span><span class="co">#&gt; $ PRECURSORTYPE   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "[M-H]-"</span></span>
<span><span class="co">#&gt; $ FORMULA         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "C30H24O12"</span></span>
<span><span class="co">#&gt; $ INCHIKEY        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "NSEWTSAADLNHNH-LSBOWGMISA-N"</span></span>
<span><span class="co">#&gt; $ SMILES          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "C1C(C(OC2=C1C(=CC3=C2C4C(C(O3)(OC5=CC(=CC(=C45)O)O)C6…</span></span>
<span><span class="co">#&gt; $ IONMODE         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Negative"</span></span>
<span><span class="co">#&gt; $ INSTRUMENTTYPE  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "LC-ESI-QTOF"</span></span>
<span><span class="co">#&gt; $ COLLISIONENERGY <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "20 eV"</span></span></code></pre></div>
<p>The three arguments for this function are:</p>
<ul>
<li>
<strong>spec:</strong> a data frame containing the extracted MS/MS
spectra</li>
<li>
<strong>spec_metadata:</strong> a data frame containing the values
to be including in the resulting .msp file</li>
<li>
<strong>msp_name:</strong> a string with the name of the msp file
not containing (.msp) extension</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write_msp.html">write_msp</a></span><span class="op">(</span></span>
<span>  spec <span class="op">=</span> <span class="va">ProcA2_detected</span>,</span>
<span>  spec_metadata <span class="op">=</span> <span class="va">metadata</span>,</span>
<span>  msp_name <span class="op">=</span> <span class="st">"Procyanidin_A2"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After writing the msp file, you will see the following file
content:</p>
<pre><code><span><span class="co">#&gt; • Filtering MS/MS scans for 20 CE</span></span>
<span><span class="co">#&gt; NAME: Procyanidin A2</span></span>
<span><span class="co">#&gt; PRECURSORMZ: 575.11957</span></span>
<span><span class="co">#&gt; PRECURSORTYPE: [M-H]-</span></span>
<span><span class="co">#&gt; FORMULA: C30H24O12</span></span>
<span><span class="co">#&gt; RETENTIONTIME: 2.844</span></span>
<span><span class="co">#&gt; IONMODE: Negative</span></span>
<span><span class="co">#&gt; COMMENT: Spectra extracted with MS2extract R package</span></span>
<span><span class="co">#&gt; INCHIKEY: NSEWTSAADLNHNH-LSBOWGMISA-N</span></span>
<span><span class="co">#&gt; SMILES: C1C(C(OC2=C1C(=CC3=C2C4C(C(O3)(OC5=CC(=CC(=C45)O)O)C6=CC(=C(C=C6)O)O)O)O)C7=CC(=C(C=C7)O)O)O</span></span>
<span><span class="co">#&gt; CCS: </span></span>
<span><span class="co">#&gt; COLLISIONENERGY: 20 eV</span></span>
<span><span class="co">#&gt; INSTRUMENTTYPE: LC-ESI-QTOF</span></span>
<span><span class="co">#&gt; Num Peaks: 38</span></span>
<span><span class="co">#&gt; 125.02431 10</span></span>
<span><span class="co">#&gt; 137.02441 3</span></span>
<span><span class="co">#&gt; 161.02449 2</span></span>
<span><span class="co">#&gt; 163.00355 3</span></span>
<span><span class="co">#&gt; 165.01881 2</span></span>
<span><span class="co">#&gt; 217.04996 2</span></span>
<span><span class="co">#&gt; 241.05002 2</span></span>
<span><span class="co">#&gt; 245.04547 2</span></span>
<span><span class="co">#&gt; 245.0817 2</span></span>
<span><span class="co">#&gt; 257.0451 2</span></span>
<span><span class="co">#&gt; 285.04063 62</span></span>
<span><span class="co">#&gt; 286.04387 4</span></span>
<span><span class="co">#&gt; 287.05579 7</span></span>
<span><span class="co">#&gt; 289.0718 48</span></span>
<span><span class="co">#&gt; 290.07495 3</span></span>
<span><span class="co">#&gt; 297.03993 4</span></span>
<span><span class="co">#&gt; 307.06114 2</span></span>
<span><span class="co">#&gt; 313.03573 2</span></span>
<span><span class="co">#&gt; 327.05044 7</span></span>
<span><span class="co">#&gt; 407.07693 16</span></span>
<span><span class="co">#&gt; 408.08161 2</span></span>
<span><span class="co">#&gt; 411.07227 9</span></span>
<span><span class="co">#&gt; 423.07231 53</span></span>
<span><span class="co">#&gt; 424.07537 5</span></span>
<span><span class="co">#&gt; 435.07138 3</span></span>
<span><span class="co">#&gt; 447.07296 5</span></span>
<span><span class="co">#&gt; 449.08799 51</span></span>
<span><span class="co">#&gt; 450.09044 6</span></span>
<span><span class="co">#&gt; 452.07453 15</span></span>
<span><span class="co">#&gt; 453.08155 7</span></span>
<span><span class="co">#&gt; 471.1086 2</span></span>
<span><span class="co">#&gt; 513.11796 2</span></span>
<span><span class="co">#&gt; 531.13006 2</span></span>
<span><span class="co">#&gt; 539.09834 22</span></span>
<span><span class="co">#&gt; 540.10156 3</span></span>
<span><span class="co">#&gt; 557.10809 5</span></span>
<span><span class="co">#&gt; 575.11968 100</span></span>
<span><span class="co">#&gt; 576.12208 13</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] MS2extract_0.01.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;   [1] Rdpack_2.5            readxl_1.4.3          rlang_1.1.1          </span></span>
<span><span class="co">#&gt;   [4] magrittr_2.0.3        clue_0.3-65           compiler_4.3.1       </span></span>
<span><span class="co">#&gt;   [7] systemfonts_1.0.4     vctrs_0.6.3           stringr_1.5.0        </span></span>
<span><span class="co">#&gt;  [10] ProtGenerics_1.32.0   pkgconfig_2.0.3       fastmap_1.1.1        </span></span>
<span><span class="co">#&gt;  [13] backports_1.4.1       labeling_0.4.3        utf8_1.2.3           </span></span>
<span><span class="co">#&gt;  [16] rmarkdown_2.25        tzdb_0.4.0            preprocessCore_1.62.1</span></span>
<span><span class="co">#&gt;  [19] ragg_1.2.5            purrr_1.0.2           xfun_0.40            </span></span>
<span><span class="co">#&gt;  [22] zlibbioc_1.46.0       cachem_1.0.8          jsonlite_1.8.7       </span></span>
<span><span class="co">#&gt;  [25] BiocParallel_1.34.2   broom_1.0.5           parallel_4.3.1       </span></span>
<span><span class="co">#&gt;  [28] cluster_2.1.4         R6_2.5.1              bslib_0.5.1          </span></span>
<span><span class="co">#&gt;  [31] stringi_1.7.12        limma_3.56.2          car_3.1-2            </span></span>
<span><span class="co">#&gt;  [34] jquerylib_0.1.4       cellranger_1.1.0      Rcpp_1.0.11          </span></span>
<span><span class="co">#&gt;  [37] iterators_1.0.14      knitr_1.44            readr_2.1.4          </span></span>
<span><span class="co">#&gt;  [40] IRanges_2.34.1        tidyselect_1.2.0      abind_1.4-5          </span></span>
<span><span class="co">#&gt;  [43] yaml_2.3.7            doParallel_1.0.17     codetools_0.2-19     </span></span>
<span><span class="co">#&gt;  [46] affy_1.78.2           lattice_0.21-8        tibble_3.2.1         </span></span>
<span><span class="co">#&gt;  [49] plyr_1.8.9            Biobase_2.60.0        withr_2.5.1          </span></span>
<span><span class="co">#&gt;  [52] evaluate_0.22         OrgMassSpecR_0.5-3    desc_1.4.2           </span></span>
<span><span class="co">#&gt;  [55] pillar_1.9.0          affyio_1.70.0         BiocManager_1.30.22  </span></span>
<span><span class="co">#&gt;  [58] ggpubr_0.6.0          carData_3.0-5         foreach_1.5.2        </span></span>
<span><span class="co">#&gt;  [61] stats4_4.3.1          MSnbase_2.26.0        MALDIquant_1.22.1    </span></span>
<span><span class="co">#&gt;  [64] ncdf4_1.21            generics_0.1.3        rprojroot_2.0.3      </span></span>
<span><span class="co">#&gt;  [67] S4Vectors_0.38.2      hms_1.1.3             ggplot2_3.4.3        </span></span>
<span><span class="co">#&gt;  [70] munsell_0.5.0         scales_1.2.1          glue_1.6.2           </span></span>
<span><span class="co">#&gt;  [73] tools_4.3.1           mzID_1.38.0           vsn_3.68.0           </span></span>
<span><span class="co">#&gt;  [76] mzR_2.34.1            ggsignif_0.6.4        fs_1.6.3             </span></span>
<span><span class="co">#&gt;  [79] XML_3.99-0.14         cowplot_1.1.1         grid_4.3.1           </span></span>
<span><span class="co">#&gt;  [82] impute_1.74.1         tidyr_1.3.0           rbibutils_2.2.15     </span></span>
<span><span class="co">#&gt;  [85] MsCoreUtils_1.12.0    colorspace_2.1-0      cli_3.6.1            </span></span>
<span><span class="co">#&gt;  [88] textshaping_0.3.6     fansi_1.0.5           dplyr_1.1.3          </span></span>
<span><span class="co">#&gt;  [91] pcaMethods_1.92.0     gtable_0.3.4          rstatix_0.7.2        </span></span>
<span><span class="co">#&gt;  [94] sass_0.4.7            digest_0.6.33         BiocGenerics_0.46.0  </span></span>
<span><span class="co">#&gt;  [97] ggrepel_0.9.3         farver_2.1.1          memoise_2.0.1        </span></span>
<span><span class="co">#&gt; [100] htmltools_0.5.6.1     pkgdown_2.0.7         lifecycle_1.0.3      </span></span>
<span><span class="co">#&gt; [103] Rdisop_1.60.0         MASS_7.3-60</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Cristian Quiroz-Moreno, Jessica Cooperstone.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
